<?xml version="1.0" encoding="UTF-8" ?>
<!--
/**
 * Copyright Â© Lyra Network.
 * This file is part of PayZen plugin for Sylius. See COPYING.md for license details.
 *
 * @author    Lyra Network (https://www.lyra.com/)
 * @copyright Lyra Network
 * @license   https://opensource.org/licenses/mit-license.html The MIT License (MIT)
 */
-->

<container xmlns="http://symfony.com/schema/dic/services" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">
    <services>
        <service id="Lyranetwork\Payzen\Repository\PaymentMethodRepositoryInterface"
                 class="Lyranetwork\Payzen\Repository\PaymentMethodRepository"
                 parent="sylius.repository.payment_method">
        </service>

        <service id="Lyranetwork\Payzen\Repository\OrderRepositoryInterface"
                 class="Lyranetwork\Payzen\Repository\OrderRepository"
                 parent="sylius.repository.order">
        </service>

        <service id="app.sylius_payment" class="Payum\Core\Bridge\Symfony\Builder\GatewayFactoryBuilder">
            <argument>Lyranetwork\Payzen\Payum\SyliusPaymentGatewayFactory</argument>
            <tag name="payum.gateway_factory_builder" factory="payzen_sylius_payment" />
        </service>

        <service id="Lyranetwork\Payzen\Form\Type\SyliusGatewayConfigurationType">
            <argument type="service" id="Lyranetwork\Payzen\Repository\PaymentMethodRepositoryInterface" />
            <argument type="service" id="router" />
            <argument type="service" id="request_stack" />
            <tag name="sylius.gateway_configuration_type" type="payzen_sylius_payment" label="sylius_payzen_plugin.ui.payzen_payment_method_title" />
            <tag name="form.type" />
        </service>

        <service id="Lyranetwork\Payzen\ContextProvider\ConfigurationContextProvider" class="Lyranetwork\Payzen\ContextProvider\ConfigurationContextProvider">
            <tag name="sylius.ui.template_event.context_provider" />
        </service>

        <service id="Lyranetwork\Payzen\Service\ConfigService">
            <argument type="service" id="Lyranetwork\Payzen\Repository\PaymentMethodRepositoryInterface" />
        </service>

        <service id="Lyranetwork\Payzen\Service\OrderService">
            <argument type="service" id="Lyranetwork\Payzen\Repository\OrderRepositoryInterface" />
            <argument type="service" id="Sylius\Bundle\ShopBundle\EmailManager\OrderEmailManagerInterface" />
            <argument type="service" id="logger" />
        </service>

        <service id="Lyranetwork\Payzen\Service\RefundService">
            <argument type="service" id="Lyranetwork\Payzen\Sdk\RestData" />
            <argument type="service" id="Lyranetwork\Payzen\Service\ConfigService" />
            <argument type="service" id="Lyranetwork\Payzen\Sdk\RefundProcessor" />
        </service>

        <service id="Lyranetwork\Payzen\Sdk\RestData">
            <argument type="service" id="Lyranetwork\Payzen\Service\ConfigService" />
            <argument type="service" id="logger" />
            <argument type="service" id="router" />
            <argument type="service" id="sylius.repository.customer" />
            <argument type="service" id="request_stack" />
        </service>

        <service id="Lyranetwork\Payzen\Sdk\RefundProcessor" public="true">
            <argument type="service" id="logger" />
            <argument type="service" id="translator" />
            <argument type="service" id="request_stack" />
            <argument type="service" id="sylius.repository.payment" />
            <argument type="service" id="sylius.manager.payment" />
            <argument key="$stateMachineFactory" type="service" id="sm.factory" />
        </service>

        <service id="sylius_payzen_plugin.twig.extension.smartform_provider" class="Lyranetwork\Payzen\Twig\Extensions\SmartformProvider">
            <argument type="service" id="logger" />
            <argument type="service" id="Lyranetwork\Payzen\Service\ConfigService" />
            <argument type="service" id="Lyranetwork\Payzen\Sdk\RestData" />
            <argument type="service" id="Lyranetwork\Payzen\Service\OrderService" />
            <argument type="service" id="sylius.context.currency" />
            <argument type="service" id="sylius.context.locale" />
            <argument key="$stateMachineFactory" type="service" id="sm.factory" />
            <tag name="twig.extension" />
        </service>

        <service id="Lyranetwork\Payzen\EventListener\AccountMenuListener">
            <argument type="service" id="Lyranetwork\Payzen\Repository\PaymentMethodRepositoryInterface" />
            <argument type="service" id="Lyranetwork\Payzen\Service\ConfigService" />
            <argument type="service" id="sylius.context.channel" />
            <tag name="kernel.event_listener" event="sylius.menu.shop.account" method="addAccountMenuItems" />
        </service>

        <service id="Lyranetwork\Payzen\Controller\CardController" public="true">
            <argument type="service" id="Lyranetwork\Payzen\Repository\PaymentMethodRepositoryInterface" />
            <argument type="service" id="sylius.repository.customer" />
            <argument type="service" id="sylius.context.customer" />
            <argument type="service" id="sylius.context.currency" />
            <argument type="service" id="Lyranetwork\Payzen\Sdk\RestData" />
            <argument type="service" id="router" />
            <argument type="service" id="twig" />
            <argument type="service" id="Lyranetwork\Payzen\Service\ConfigService" />
            <argument type="service" id="sylius.context.channel" />
            <tag name="controller.service_arguments" />
        </service>

        <service id="Lyranetwork\Payzen\Controller\RefundController" public="true">
            <argument type="service" id="sylius.repository.payment" />
            <argument type="service" id="logger" />
            <argument type="service" id="Lyranetwork\Payzen\Service\OrderService" />
            <argument type="service" id="Lyranetwork\Payzen\Service\RefundService" />
            <argument type="service" id="sylius.manager.payment" />
            <argument type="service" id="request_stack" />
            <argument key="$stateMachineFactory" type="service" id="sm.factory" />
        </service>

        <service id="Lyranetwork\Payzen\Controller\OrderController" public="true" parent="sylius.controller.order">
            <argument type="service" id="logger" />
            <argument type="service" id="Lyranetwork\Payzen\Sdk\RestData" />
            <argument type="service" id="Lyranetwork\Payzen\Service\ConfigService" />
            <argument type="service" id="Lyranetwork\Payzen\Service\OrderService" />
            <argument type="service" id="Lyranetwork\Payzen\Repository\PaymentMethodRepositoryInterface" />
            <argument type="service" id="translator" />
            <argument type="service" id="sylius.context.locale" />
            <argument type="service" id="router" />
            <argument key="$stateMachineFactory" type="service" id="sm.factory" />
        </service>
    </services>
</container>