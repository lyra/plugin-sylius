<?xml version="1.0" encoding="UTF-8" ?>
<!--
/**
 * Copyright Â© Lyra Network.
 * This file is part of Systempay plugin for Sylius. See COPYING.md for license details.
 *
 * @author    Lyra Network (https://www.lyra.com/)
 * @copyright Lyra Network
 * @license   https://opensource.org/licenses/mit-license.html The MIT License (MIT)
 */
-->

<container xmlns="http://symfony.com/schema/dic/services" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">
    <services>
        <service id="Lyranetwork\Systempay\Repository\PaymentMethodRepositoryInterface"
                 class="Lyranetwork\Systempay\Repository\PaymentMethodRepository"
                 parent="sylius.repository.payment_method">
        </service>

        <service id="Lyranetwork\Systempay\Repository\OrderRepositoryInterface"
                 class="Lyranetwork\Systempay\Repository\OrderRepository"
                 parent="sylius.repository.order">
        </service>

        <service id="Lyranetwork\Systempay\Form\Type\SyliusGatewayConfigurationType">
            <argument type="service" id="Lyranetwork\Systempay\Repository\PaymentMethodRepositoryInterface" />
            <argument type="service" id="router" />
            <argument type="service" id="request_stack" />
            <tag name="sylius.gateway_configuration_type" type="systempay_sylius_payment" label="sylius_systempay_plugin.ui.systempay_payment_method_title" />
            <tag name="form.type" />
        </service>

        <service id="Lyranetwork\Systempay\ContextProvider\ConfigurationContextProvider" class="Lyranetwork\Systempay\ContextProvider\ConfigurationContextProvider">
            <tag name="sylius.ui.template_event.context_provider" />
        </service>

        <service id="Lyranetwork\Systempay\Service\ConfigService">
            <argument type="service" id="Lyranetwork\Systempay\Repository\PaymentMethodRepositoryInterface" />
        </service>

        <service id="Lyranetwork\Systempay\Service\OrderService">
            <argument type="service" id="Lyranetwork\Systempay\Repository\OrderRepositoryInterface" />
            <argument type="service" id="Sylius\Bundle\CoreBundle\Mailer\OrderEmailManagerInterface" />
            <argument type="service" id="logger" />
        </service>

        <service id="Lyranetwork\Systempay\Service\RefundService">
            <argument type="service" id="Lyranetwork\Systempay\Sdk\RestData" />
            <argument type="service" id="Lyranetwork\Systempay\Service\ConfigService" />
            <argument type="service" id="Lyranetwork\Systempay\Sdk\RefundProcessor" />
        </service>

        <service id="Lyranetwork\Systempay\Sdk\RestData">
            <argument type="service" id="Lyranetwork\Systempay\Service\ConfigService" />
            <argument type="service" id="logger" />
            <argument type="service" id="router" />
            <argument type="service" id="sylius.repository.customer" />
            <argument type="service" id="request_stack" />
        </service>

        <service id="Lyranetwork\Systempay\Sdk\RefundProcessor" public="true">
            <argument type="service" id="logger" />
            <argument type="service" id="translator" />
            <argument type="service" id="request_stack" />
            <argument type="service" id="Lyranetwork\Systempay\Repository\OrderRepositoryInterface" />
            <argument type="service" id="sylius.manager.payment" />
            <argument type="service" id="sylius_abstraction.state_machine" />
        </service>

        <service id="sylius_systempay_plugin.twig.extension.smartform_provider" class="Lyranetwork\Systempay\Twig\Extensions\SmartformProvider">
            <argument type="service" id="logger" />
            <argument type="service" id="Lyranetwork\Systempay\Service\ConfigService" />
            <argument type="service" id="Lyranetwork\Systempay\Sdk\RestData" />
            <argument type="service" id="Lyranetwork\Systempay\Service\OrderService" />
            <argument type="service" id="sylius_abstraction.state_machine" />
            <argument type="service" id="sylius.context.locale" />
            <tag name="twig.extension" />
        </service>

        <service id="sylius_systempay_plugin.twig.extension.configuration_provider" class="Lyranetwork\Systempay\Twig\Extensions\ConfigurationProvider">
            <argument type="service" id="translator" />
            <argument type="service" id="request_stack" />
            <tag name="twig.extension" />
        </service>

        <service id="Lyranetwork\Systempay\EventListener\AccountMenuListener">
            <argument type="service" id="Lyranetwork\Systempay\Repository\PaymentMethodRepositoryInterface" />
            <argument type="service" id="Lyranetwork\Systempay\Service\ConfigService" />
            <argument type="service" id="sylius.context.channel" />
            <tag name="kernel.event_listener" event="sylius.menu.shop.account" method="addAccountMenuItems" />
        </service>

        <service id="sylius_systempay_plugin.event_listener.order_workflow" class="Lyranetwork\Systempay\EventListener\OrderWorkflowListener">
            <argument type="service" id="Lyranetwork\Systempay\Service\OrderService" />

            <tag name="kernel.event_listener" event="workflow.sylius_payment.completed.complete" priority="-100" />
        </service>

        <service id="Lyranetwork\Systempay\Controller\CardController" public="true">
            <argument type="service" id="Lyranetwork\Systempay\Repository\PaymentMethodRepositoryInterface" />
            <argument type="service" id="sylius.repository.customer" />
            <argument type="service" id="sylius.context.customer" />
            <argument type="service" id="sylius.context.currency" />
            <argument type="service" id="Lyranetwork\Systempay\Sdk\RestData" />
            <argument type="service" id="router" />
            <argument type="service" id="twig" />
            <argument type="service" id="Lyranetwork\Systempay\Service\ConfigService" />
            <argument type="service" id="sylius.context.channel" />
            <tag name="controller.service_arguments" />
        </service>

        <service id="Lyranetwork\Systempay\Controller\RefundController" public="true">
            <argument type="service" id="sylius.repository.payment" />
            <argument type="service" id="logger" />
            <argument type="service" id="Lyranetwork\Systempay\Service\OrderService" />
            <argument type="service" id="Lyranetwork\Systempay\Service\RefundService" />
            <argument type="service" id="sylius.manager.payment" />
            <argument type="service" id="request_stack" />
            <argument type="service" id="sylius_abstraction.state_machine" />
        </service>

        <service id="Lyranetwork\Systempay\Controller\OrderController" public="true" parent="sylius.controller.order">
            <argument type="service" id="logger" />
            <argument type="service" id="Lyranetwork\Systempay\Sdk\RestData" />
            <argument type="service" id="Lyranetwork\Systempay\Service\ConfigService" />
            <argument type="service" id="Lyranetwork\Systempay\Service\OrderService" />
            <argument type="service" id="Lyranetwork\Systempay\Repository\PaymentMethodRepositoryInterface" />
            <argument type="service" id="translator" />
            <argument type="service" id="sylius.context.locale" />
            <argument type="service" id="router" />
            <argument type="service" id="sylius_abstraction.state_machine" />
        </service>
    </services>
</container>